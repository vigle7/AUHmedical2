"use strict";
var core_1 = require("@angular/core");
var router_1 = require("@angular/router");
var page_1 = require("ui/page");
var appSettings = require("application-settings");
var Toast = require("nativescript-toast");
var fetchModule = require("fetch");
var xmlModule = require("xml");
var LoginComponent = (function () {
    function LoginComponent(router, page) {
        var _this = this;
        this.router = router;
        this.page = page;
        this.xmlToJsonResult = [];
        this.onEventCallback = function (event) {
            switch (event.eventType) {
                case xmlModule.ParserEventType.Text:
                    var significantText = event.data.trim();
                    if (significantText !== "" && significantText !== undefined) {
                        _this.xmlToJsonResult.push(significantText);
                    }
                    break;
            }
        };
        this.onErrorCallback = function (error) {
            console.log("Error: " + error.message);
        };
    }
    LoginComponent.prototype.ngOnInit = function () {
        if (appSettings.getString("id") !== undefined && appSettings.getString("password") !== undefined && appSettings.getBoolean("checked") !== undefined) {
            this.id = appSettings.getString("id");
            this.password = appSettings.getString("password");
            this.signatureCheckBox.nativeElement.checked = appSettings.getBoolean("checked");
        }
        this.showLogin = true;
        //this.page.actionBar.title = "申請會員";
        //this.page.actionBarHidden = true;
        //this.page.backgroundImage = this.page.ios ? "res://homebg_ldpi_asia.png" : "res://homebg_ldpi_asia.png";
    };
    LoginComponent.prototype.login = function () {
        var _this = this;
        this.showLogin = false;
        this.xmlToJsonResult = [];
        var details = {
            'member_id': this.id,
            'member_passwd': this.password,
            'hospno': 22,
            'tokentype': 'D2',
            'WSPassword': 'appmobile_cmuh',
            'WSuserid': 'cmuh_appmobile',
            'tokenid': 'APA91bHd_8dywVKLPMsCk4jgv0MRisi-4paYhIx4Y0EaudERFNG7w_QWnzPih7LPncaGzoNbVHUXxRz0FrqNJEbtT2tvvHhGB1vwSgxPyWfBwvj7T3GaK5VlyzyCyRgXf6tYcibN7F_M'
        };
        var formBody = [];
        for (var property in details) {
            var encodedKey = encodeURIComponent(property);
            var encodedValue = encodeURIComponent(details[property]);
            formBody.push(encodedKey + "=" + encodedValue);
        }
        var bodyString = formBody.join("&");
        // var data = encodeURI("member_id=this.id&member_passwd=this.password&hospno=22&tokentype=D2&WSPassword=appmobile_cmuh&WSuserid=cmuh_appmobile&tokenid=APA91bHd_8dywVKLPMsCk4jgv0MRisi-4paYhIx4Y0EaudERFNG7w_QWnzPih7LPncaGzoNbVHUXxRz0FrqNJEbtT2tvvHhGB1vwSgxPyWfBwvj7T3GaK5VlyzyCyRgXf6tYcibN7F_M");
        fetchModule.fetch("http://122.146.168.11/AppWebService/AppService.asmx/ChkAppMemberPassWord", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: bodyString
        }).then(function (response) {
            //console.log(response._bodyText);
            //this.result = [];
            _this.showLogin = true;
            var xmlParser = new xmlModule.XmlParser(_this.onEventCallback, _this.onErrorCallback, true);
            xmlParser.parse(response._bodyText);
            console.log("result:" + _this.xmlToJsonResult);
            if (_this.xmlToJsonResult[0] === "2") {
                var toast = Toast.makeText("登入成功");
                toast.show();
                _this.router.navigate(["/menu"]);
            }
            if (_this.xmlToJsonResult[0] === "0") {
                var toast = Toast.makeText("登入失敗");
                toast.show();
                return;
            }
            if (_this.signatureCheckBox.nativeElement.checked) {
                appSettings.setString("id", _this.id);
                appSettings.setString("password", _this.password);
                appSettings.setBoolean("checked", true);
            }
            else {
                if (appSettings.getString("id") === undefined || appSettings.getString("password") === undefined && appSettings.getBoolean("checked") !== undefined) {
                    return;
                }
                appSettings.remove("id");
                appSettings.remove("password");
                appSettings.remove("checked");
            }
        }, function (error) {
            _this.showLogin = true;
            console.log(error);
        });
    };
    __decorate([
        core_1.ViewChild("CB"), 
        __metadata('design:type', core_1.ElementRef)
    ], LoginComponent.prototype, "signatureCheckBox", void 0);
    LoginComponent = __decorate([
        core_1.Component({
            selector: "login",
            templateUrl: "pages/login/login.html",
            styleUrls: ["pages/login/login-common.css", "pages/login/login.css"],
        }), 
        __metadata('design:paramtypes', [router_1.Router, page_1.Page])
    ], LoginComponent);
    return LoginComponent;
}());
exports.LoginComponent = LoginComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9naW4uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibG9naW4uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxxQkFBeUQsZUFBZSxDQUFDLENBQUE7QUFDekUsdUJBQXVCLGlCQUFpQixDQUFDLENBQUE7QUFDekMscUJBQXFCLFNBQVMsQ0FBQyxDQUFBO0FBRy9CLElBQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0FBRXBELElBQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0FBQzVDLElBQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUNyQyxJQUFNLFNBQVMsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7QUFRakM7SUFRRSx3QkFBb0IsTUFBYyxFQUFXLElBQVU7UUFSekQsaUJBMklDO1FBbklxQixXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQVcsU0FBSSxHQUFKLElBQUksQ0FBTTtRQUgzQyxvQkFBZSxHQUFlLEVBQUUsQ0FBQztRQThHN0Msb0JBQWUsR0FBSSxVQUFDLEtBQUs7WUFHckIsTUFBTSxDQUFDLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7Z0JBR3RCLEtBQUssU0FBUyxDQUFDLGVBQWUsQ0FBQyxJQUFJO29CQUMvQixJQUFJLGVBQWUsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO29CQUMxQyxFQUFFLENBQUMsQ0FBQyxlQUFlLEtBQUssRUFBRSxJQUFJLGVBQWUsS0FBSSxTQUFTLENBQUMsQ0FBQyxDQUFDO3dCQUN2RCxLQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztvQkFJL0MsQ0FBQztvQkFDRCxLQUFLLENBQUM7WUFFZCxDQUFDO1FBQ0wsQ0FBQyxDQUFDO1FBRUYsb0JBQWUsR0FBRyxVQUFDLEtBQVk7WUFDM0IsT0FBTyxD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LENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztZQUN0QixPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBR2IsQ0FBQztJQTlHRjtRQUFDLGdCQUFTLENBQUMsSUFBSSxDQUFDOzs2REFBQTtJQVJqQjtRQUFDLGdCQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsT0FBTztZQUVqQixXQUFXLEVBQUUsd0JBQXdCO1lBQ3JDLFNBQVMsRUFBRSxDQUFDLDhCQUE4QixFQUFFLHVCQUF1QixDQUFDO1NBQ3JFLENBQUM7O3NCQUFBO0lBNElGLHFCQUFDO0FBQUQsQ0FBQyxBQTNJRCxJQTJJQztBQTNJWSxzQkFBYyxpQkEySTFCLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEVsZW1lbnRSZWYsIE9uSW5pdCwgVmlld0NoaWxkIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IFJvdXRlciB9IGZyb20gXCJAYW5ndWxhci9yb3V0ZXJcIjtcbmltcG9ydCB7IFBhZ2UgfSBmcm9tIFwidWkvcGFnZVwiO1xuaW1wb3J0IHsgVGV4dEZpZWxkIH0gZnJvbSBcInVpL3RleHQtZmllbGRcIjtcbmltcG9ydCB7IFZpZXcgfSBmcm9tIFwidWkvY29yZS92aWV3XCI7XG5jb25zdCBhcHBTZXR0aW5ncyA9IHJlcXVpcmUoXCJhcHBsaWNhdGlvbi1zZXR0aW5nc1wiKTtcblxuY29uc3QgVG9hc3QgPSByZXF1aXJlKFwibmF0aXZlc2NyaXB0LXRvYXN0XCIpO1xuY29uc3QgZmV0Y2hNb2R1bGUgPSByZXF1aXJlKFwiZmV0Y2hcIik7XG5jb25zdCB4bWxNb2R1bGUgPSByZXF1aXJlKFwieG1sXCIpO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6IFwibG9naW5cIixcblxuICB0ZW1wbGF0ZVVybDogXCJwYWdlcy9sb2dpbi9sb2dpbi5odG1sXCIsXG4gIHN0eWxlVXJsczogW1wicGFnZXMvbG9naW4vbG9naW4tY29tbW9uLmNzc1wiLCBcInBhZ2VzL2xvZ2luL2xvZ2luLmNzc1wiXSxcbn0pXG5leHBvcnQgY2xhc3MgTG9naW5Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG5cdEBWaWV3Q2hpbGQoXCJDQlwiKSBzaWduYXR1cmVDaGVja0JveDogRWxlbWVudFJlZjtcbiAgICAgIHByaXZhdGUgaWQ6c3RyaW5nO1xuICAgICAgcHJpdmF0ZSBwYXNzd29yZDpzdHJpbmc7XG4gICAgICBwcml2YXRlIHhtbFRvSnNvblJlc3VsdDpBcnJheTxzdHJpbmc+PVtdO1xuICAgICAgcHJpdmF0ZSBzaG93TG9naW46Ym9vbGVhbjtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJvdXRlcjogUm91dGVyLCAgcHJpdmF0ZSBwYWdlOiBQYWdlKSB7XG5cbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuXG4gICAgICAgIGlmKGFwcFNldHRpbmdzLmdldFN0cmluZyhcImlkXCIpIT09dW5kZWZpbmVkICYmIGFwcFNldHRpbmdzLmdldFN0cmluZyhcInBhc3N3b3JkXCIpIT09dW5kZWZpbmVkJiZhcHBTZXR0aW5ncy5nZXRCb29sZWFuKFwiY2hlY2tlZFwiKSE9PXVuZGVmaW5lZCl7XG4gICAgICAgICAgdGhpcy5pZCA9IGFwcFNldHRpbmdzLmdldFN0cmluZyhcImlkXCIpO1xuICAgICAgICAgIHRoaXMucGFzc3dvcmQgPSBhcHBTZXR0aW5ncy5nZXRTdHJpbmcoXCJwYXNzd29yZFwiKTtcbiAgICAgICAgICB0aGlzLnNpZ25hdHVyZUNoZWNrQm94Lm5hdGl2ZUVsZW1lbnQuY2hlY2tlZCA9IGFwcFNldHRpbmdzLmdldEJvb2xlYW4oXCJjaGVja2VkXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zaG93TG9naW4gPSB0cnVlO1xuXG4gICAgLy90aGlzLnBhZ2UuYWN0aW9uQmFyLnRpdGxlID0gXCLnlLPoq4vmnIPlk6FcIjtcbiAgICAvL3RoaXMucGFnZS5hY3Rpb25CYXJIaWRkZW4gPSB0cnVlO1xuICAgIC8vdGhpcy5wYWdlLmJhY2tncm91bmRJbWFnZSA9IHRoaXMucGFnZS5pb3MgPyBcInJlczovL2hvbWViZ19sZHBpX2FzaWEucG5nXCIgOiBcInJlczovL2hvbWViZ19sZHBpX2FzaWEucG5nXCI7XG4gIH1cblxuXG5cbiAgbG9naW4oKSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2dpbiA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgdGhpcy54bWxUb0pzb25SZXN1bHQgPSBbXTtcblxuICAgICAgICAgICAgICAgIGxldCBkZXRhaWxzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbWVtYmVyX2lkJzogdGhpcy5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21lbWJlcl9wYXNzd2QnOiB0aGlzLnBhc3N3b3JkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaG9zcG5vJzogMjIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0b2tlbnR5cGUnOiAnRDInLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnV1NQYXNzd29yZCc6ICdhcHBtb2JpbGVfY211aCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdXU3VzZXJpZCc6ICdjbXVoX2FwcG1vYmlsZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0b2tlbmlkJzonQVBBOTFiSGRfOGR5d1ZLTFBNc0NrNGpndjBNUmlzaS00cGFZaEl4NFkwRWF1ZEVSRk5HN3dfUVduelBpaDdMUG5jYUd6b05iVkhVWHhSejBGcnFOSkVidFQydHZ2SGhHQjF2d1NneFB5V2ZCd3ZqN1QzR2FLNVZseXp5Q3lSZ1hmNnRZY2liTjdGX00nXG5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZm9ybUJvZHkgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBwcm9wZXJ0eSBpbiBkZXRhaWxzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZW5jb2RlZEtleSA9IGVuY29kZVVSSUNvbXBvbmVudChwcm9wZXJ0eSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZW5jb2RlZFZhbHVlID0gZW5jb2RlVVJJQ29tcG9uZW50KGRldGFpbHNbcHJvcGVydHldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1Cb2R5LnB1c2goZW5jb2RlZEtleSArIFwiPVwiICsgZW5jb2RlZFZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgYm9keVN0cmluZyA9IGZvcm1Cb2R5LmpvaW4oXCImXCIpO1xuXG4gICAgICAgICAgLy8gdmFyIGRhdGEgPSBlbmNvZGVVUkkoXCJtZW1iZXJfaWQ9dGhpcy5pZCZtZW1iZXJfcGFzc3dkPXRoaXMucGFzc3dvcmQmaG9zcG5vPTIyJnRva2VudHlwZT1EMiZXU1Bhc3N3b3JkPWFwcG1vYmlsZV9jbXVoJldTdXNlcmlkPWNtdWhfYXBwbW9iaWxlJnRva2VuaWQ9QVBBOTFiSGRfOGR5d1ZLTFBNc0NrNGpndjBNUmlzaS00cGFZaEl4NFkwRWF1ZEVSRk5HN3dfUVduelBpaDdMUG5jYUd6b05iVkhVWHhSejBGcnFOSkVidFQydHZ2SGhHQjF2d1NneFB5V2ZCd3ZqN1QzR2FLNVZseXp5Q3lSZ1hmNnRZY2liTjdGX01cIik7XG5cbiAgICAgICAgICAgIGZldGNoTW9kdWxlLmZldGNoKFwiaHR0cDovLzEyMi4xNDYuMTY4LjExL0FwcFdlYlNlcnZpY2UvQXBwU2VydmljZS5hc214L0Noa0FwcE1lbWJlclBhc3NXb3JkXCIsIHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIiB9LFxuICAgICAgICAgICAgICAgIGJvZHk6IGJvZHlTdHJpbmdcbiAgICAgICAgICAgIH0pLnRoZW4oKHJlc3BvbnNlKT0+IHtcblxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2cocmVzcG9uc2UuX2JvZHlUZXh0KTtcblxuICAgICAgICAgICAgICAgIC8vdGhpcy5yZXN1bHQgPSBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2dpbiA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICBsZXQgeG1sUGFyc2VyID0gbmV3IHhtbE1vZHVsZS5YbWxQYXJzZXIodGhpcy5vbkV2ZW50Q2FsbGJhY2ssIHRoaXMub25FcnJvckNhbGxiYWNrLHRydWUpO1xuICAgICAgICAgICAgICAgIHhtbFBhcnNlci5wYXJzZShyZXNwb25zZS5fYm9keVRleHQpO1xuXG4gICAgICAgICAgICAgICAgICBcblxuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJyZXN1bHQ6XCIrdGhpcy54bWxUb0pzb25SZXN1bHQpO1xuICAgIFxuXG4gICAgICAgICAgICAgICAgaWYodGhpcy54bWxUb0pzb25SZXN1bHRbMF09PT1cIjJcIil7XG4gICAgICAgICAgICAgICAgICBsZXQgdG9hc3QgPSBUb2FzdC5tYWtlVGV4dChcIueZu+WFpeaIkOWKn1wiKTtcbiAgICAgICAgICAgICAgICAgIHRvYXN0LnNob3coKTtcbiAgICAgICAgICAgICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFtcIi9tZW51XCJdKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZih0aGlzLnhtbFRvSnNvblJlc3VsdFswXT09PVwiMFwiKXtcbiAgICAgICAgICAgICAgICAgIGxldCB0b2FzdCA9IFRvYXN0Lm1ha2VUZXh0KFwi55m75YWl5aSx5pWXXCIpO1xuICAgICAgICAgICAgICAgICAgdG9hc3Quc2hvdygpO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgICAgICBpZih0aGlzLnNpZ25hdHVyZUNoZWNrQm94Lm5hdGl2ZUVsZW1lbnQuY2hlY2tlZCl7XG4gICAgICAgICAgICAgICAgICAgIGFwcFNldHRpbmdzLnNldFN0cmluZyhcImlkXCIsIHRoaXMuaWQpO1xuICAgICAgICAgICAgICAgICAgICBhcHBTZXR0aW5ncy5zZXRTdHJpbmcoXCJwYXNzd29yZFwiLCB0aGlzLnBhc3N3b3JkKTtcbiAgICAgICAgICAgICAgICAgICAgYXBwU2V0dGluZ3Muc2V0Qm9vbGVhbihcImNoZWNrZWRcIiwgdHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICB9ZWxzZXtcblxuICAgICAgICAgICAgICAgICAgaWYoYXBwU2V0dGluZ3MuZ2V0U3RyaW5nKFwiaWRcIik9PT11bmRlZmluZWQgfHwgYXBwU2V0dGluZ3MuZ2V0U3RyaW5nKFwicGFzc3dvcmRcIik9PT11bmRlZmluZWQmJmFwcFNldHRpbmdzLmdldEJvb2xlYW4oXCJjaGVja2VkXCIpIT09dW5kZWZpbmVkKXtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgIGFwcFNldHRpbmdzLnJlbW92ZShcImlkXCIpO1xuICAgICAgICAgICAgICAgICAgYXBwU2V0dGluZ3MucmVtb3ZlKFwicGFzc3dvcmRcIik7XG4gICAgICAgICAgICAgICAgICBhcHBTZXR0aW5ncy5yZW1vdmUoXCJjaGVja2VkXCIpO1xuICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgfSwgKGVycm9yKSA9PntcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2dpbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgfSk7XG5cblxuICB9XG4gIFxuXG4gIG9uRXZlbnRDYWxsYmFjayA9ICAoZXZlbnQpPT4ge1xuXG5cbiAgICAgIHN3aXRjaCAoZXZlbnQuZXZlbnRUeXBlKSB7XG5cblxuICAgICAgICAgIGNhc2UgeG1sTW9kdWxlLlBhcnNlckV2ZW50VHlwZS5UZXh0OlxuICAgICAgICAgICAgICBsZXQgc2lnbmlmaWNhbnRUZXh0ID0gZXZlbnQuZGF0YS50cmltKCk7XG4gICAgICAgICAgICBpZiAoc2lnbmlmaWNhbnRUZXh0ICE9PSBcIlwiICYmIHNpZ25pZmljYW50VGV4dCAhPT11bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgIHRoaXMueG1sVG9Kc29uUmVzdWx0LnB1c2goc2lnbmlmaWNhbnRUZXh0KTtcblxuICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2codGhhdC5yZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coXCJ0eXBlIG9mIDpcIiArdHlwZW9mIHNpZ25pZmljYW50VGV4dClcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgfVxuICB9O1xuXG4gIG9uRXJyb3JDYWxsYmFjayA9IChlcnJvcjogRXJyb3IpPT4ge1xuICAgICAgY29uc29sZS5sb2coXCJFcnJvcjogXCIgKyBlcnJvci5tZXNzYWdlKTtcbiAgfTtcblxuXG59XG4iXX0=